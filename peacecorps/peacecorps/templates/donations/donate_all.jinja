{% extends "donations/base.jinja" %}

{% block title %}Peace Corps{% endblock %}
{% block header %}Peace Corps{% endblock %}
{% block content_class %}landing{% endblock %}

{% block content %}

<section class="blurb u-clearfix">
  <h2 class="t-blurb--md t--black">
    Explore here and support the work that Peace Corps volunteers are doing
    to improve our world.
  </h2>
</section>

<nav class="js-discoverNav u-clearl banner banner--secondary">
  <ul class="u-unmarked_list u-inline_list">
    <li class="md-hide sm-hide">
      <span class="t-title--5">Select a category to browse and give:</span>
    </li>
    <li class="t-title--5 sub_nav__link">
      <a class="t--white" href="#" data-filter-type="issue">Issues</a>
    </li>
    <li class="t-title--5 sub_nav__link">
      <a class="t--white" href="#" data-filter-type="country">Countries</a>
    </li>
    <li class="t-title--5 sub_nav__link">
      <a class="t--white" href="#" data-filter-type="volunteer">Volunteers</a>
    </li>
  </ul>
</nav>

<article class="js-discoverApp">
  <ul class="js-filterable u-unmarked_list u-clearfix"
      data-filter-type="issue">
  {% for issue in issues %}
    {% for campaign in issue.campaigns.all() %}
      <li class="section--neutral_dark
          u-clearfix
          bordered--row
          bordered--white">
        {{ render_campaign(campaign, issue) }}
      </li>
    {% endfor %}
      {# TODO figure out projects rather the featured projects #}
    {% for project in issue.projects() %}
      <li class="section--neutral_medium
          u-clearfix
          bordered--row
          bordered--white">
        {{ render_project(project, 'issue') }}
      </li>
    {% endfor %}
  {% endfor %}
  </ul>
  <ul class="js-filterable u-unmarked_list u-clearfix"
       data-filter-type="volunteer">
  {% for project in projects %}
    <li class="section--neutral_medium
          u-clearfix
          bordered--row
          bordered--white">
      {{ render_project(project, 'volunteer') }}
    </li>
  {% endfor %}
  </ul>
  <ul  class="js-filterable u-unmarked_list u-clearfix"
       data-filter-type="country">
  {% for country in countries %}
    <li class="section--neutral_dark
          u-clearfix
          bordered--row
          bordered--white">
      {{ render_country_campaign(country) }}
    </li>
    {# TODO figure out projects rather the featured projects #}
    {% for project in country.project_set.all() %}
      <li class="section--neutral_medium
          u-clearfix
          bordered--row
          bordered--white">
        {{ render_project(project, 'country') }}
      </li>
    {% endfor %}
  {% endfor %}
  </ul>
</article>

{% endblock %}

{% macro country_map(code) -%}
  <div class="mask mask--bordered mask--md mask--oval
              mask--bordered mask--gray-1 u-h_center--block map">
    <img src="{{ static("peacecorps/img/countries/" + code.lower()
                        + ".svg") }}"
         class="mask__content mask__content--md" />
  </div>
{%- endmacro %}

{% macro render_campaign(campaign, issue) -%}
  {# TODO find way to link to media urls #}
  <aside class="grid--20 section__content--contain" style="padding-right: 0">
    <img class="u-pullr"
      style="width: 42%; padding-right: 0;"
      src="{{ media('World-by-Ana-Maria-Lora-Macias-CC-BY.png') }}"
      alt="{{ campaign.name }}" />
  </aside>
  <article class="grid--80 section__content--contain">
    <h2 class="t-title--2">{{ issue.name }}</h2>
    <h3 class="t-heading--3 t--primary">{{ campaign.name }}</h3>
    {{ campaign.description.html|safe }}
    <a class="button button--sm button--primary"
       href="{{ url("donate campaign", slug=campaign.slug) }}">
      Give to this fund</a>
  </article>
{%- endmacro %}

{% macro render_country_campaign(campaign) -%}
  <aside class="grid--20 section__content--contain" style="padding-right: 0">
    <div class="u-pullr"
        style="width: 50%; padding-right: 0;">
      {{ country_map(campaign.country.code) }}
    </div>
  </aside>
  <article class="grid--80 section__content--contain">
    <h2 class="t-title--2">{{ campaign.country.name }}</h2>
    <div class="content-block text-block">
      <p>{{ campaign.description }}</p>
    </div>
    <a class="button button--sm button--primary"
       href="{{ url("donate campaign", slug=campaign.slug) }}">
      Give to this fund</a>
  </article>
{%- endmacro %}

{% macro render_project(project, ptype) -%}
  <header>
    <a aria-expanded="false" href="#"
       aria-controls="collapsible-{{ ptype }}-{{ project.id }}">
      {# TODO fix empty element #}
      <div class="grid--20" style="height: 1em;"></div>
      <h3 class="t-heading--3 t--gray--2 grid--80
          section__content--contain--sm">
        {{ project.title }}</h3>
    </a>
  </header>
  <article class="js-collapsibleItem"
        id="collapsible-{{ ptype }}-{{ project.id }}" aria-hidden="true">
    <aside>
      <img src="{{ media(project.volunteerpicture or '') }}"
           alt="{{ project.volunteername }}" />
    </aside>
    <section>
      <h3>{{ project.title }}</h3>
      <p>{{ project.abstract_html()|safe }}</p>

      <div class="rectangular_progress rectangular_progress--secondary">
        {# TODO make macro #}
        {% set percent_completed = project.account.percent_funded() %}
        <div class="rectangular_progress__bar">
          <div class="rectangular_progress__filled"
              style="width: {{ percent_completed }}%;">
          </div>
        </div>
      </div>
      <a class="button button--sm button--primary" href="">
       Give to the project</a>
      <a href="{{ url("donate project", slug=project.slug) }}">
        Read more</a>
    </section>
  </article>
{%- endmacro %}

